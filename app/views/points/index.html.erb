<div id="map"></div>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.config.google_api_key %>&callback=initMap">
</script>
<script>
  var myLatLng = {lat: 53.961414000000005, lng: 27.622927999999998};
  var addedPoints = [];
  var map;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
      center: myLatLng,
      scrollwheel: true
    });
  }

  $(document).ready(function() {
    console.log('test');
  });

  function setPoints() {
    console.log('set points');
    
    $.ajax({
      url: "json",
      dataType: 'json',
      context: document.body
    }).done(function(points) {
      console.log(points);
  
      points.forEach(function(point) {
        console.log('point', point);
        
        console.log(addedPoints.indexOf(point.id));
        if (addedPoints.indexOf(point.id) === -1) {
          addedPoints.push(point.id);
  
          var marker = new google.maps.Marker({
            position: point,
            map: map,
            title: point.title
          });
        }
      });      
    });
  }
  
  setInterval(setPoints, 5000);
</script>

<table class="table table-sm">
  <thead>
    <tr>
      <th>title</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>altitude</th>
      <th>direction</th>
      <th>options</th>
    </tr>
  </thead>
  <tbody>
    <% @points.each do |point| %>
      <tr>
        <td><%= point.title %></td>
        <td><%= point.lat %></td>
        <td><%= point.lon %></td>
        <td><%= point.altitude %></td>
        <td><%= point.direction %></td>
        <td><%= link_to 'Delete', point_path(point), method: :delete %></td>
      </tr>
    <% end %>
  </tbody>
</table>
